<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Linux启动流程 · 为兰 若谷</title><meta name="description" content="Linux启动流程 - Tian"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/hermes.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="为兰 若谷"><meta name="generator" content="Hexo 5.3.0"></head><body><div class="wrap"><header><a class="logo-link" href="/"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="/archives/" target="_self">目录</a></li><li class="nav-list-item"><a class="nav-list-link" href="/tags/%E7%BD%91%E7%BB%9C/" target="_self">网络</a></li><li class="nav-list-item"><a class="nav-list-link" href="/tags/Linux/" target="_self">LINUX</a></li><li class="nav-list-item"><a class="nav-list-link" href="/tags/Mysql/" target="_self">MYSQL</a></li><li class="nav-list-item"><a class="nav-list-link" href="/tags/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" target="_self">算法与数据结构</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Linux启动流程</h1><div class="post-info">2021年3月15日</div><div class="post-content"><ol>
<li><p> 载入BIOS的硬件信息与自我检测，找到第一个可开机设备；</p>
</li>
<li><p>读取并执行第一个开机设备中MBR的boot Loader；</p>
<p> ​    执行Boot loader主程序</p>
<p> ​    主程序载入配置文件（包括文件系统定义与主要配置文件grub.cfg）</p>
</li>
<li><p>根据boot loader载入Kernel，kernel会开始侦测硬件并载入驱动；</p>
<p> 在这一步Kernel（核心文件为/boot/vmlinuz）接管开机流程，以自己的功能重新侦测一边硬件，不一定使用BIOS侦测到的。之后挂载虚拟文件系统（/boot/initramfs），加载开机过程中所需的重要模块。</p>
</li>
<li><p>硬件驱动成功后，kennel主动调用systemd程序，并以default.target启动。</p>
<p> systemd负责准备软件执行的环境，包含系统的主机名称，网络设置，语系处理、文件系统格式等。default.target位于/etc/systemd/system/，其中包含启动的目标态（对应老版本的runlevel）与默认启动服务单元集合。</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/systemd/system/default.target</span><br><span class="line">    <span class="comment">#  This file is part of systemd.</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#  systemd is free software; you can redistribute it and/or modify it</span></span><br><span class="line">    <span class="comment">#  under the terms of the GNU Lesser General Public License as published by</span></span><br><span class="line">    <span class="comment">#  the Free Software Foundation; either version 2.1 of the License, or</span></span><br><span class="line">    <span class="comment">#  (at your option) any later version.</span></span><br><span class="line"></span><br><span class="line">    [Unit]</span><br><span class="line">    Description=Multi-User System</span><br><span class="line">    Documentation=man:systemd.special(7)</span><br><span class="line">    Requires=basic.target</span><br><span class="line">    Conflicts=rescue.service rescue.target</span><br><span class="line">    After=basic.target rescue.service rescue.target</span><br><span class="line">    AllowIsolate=yes</span><br></pre></td></tr></table></figure>
<p> 可以使用systemctl list-dependencies查看服务启动的服务，实验机结果如下：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">systemctl list-dependencies</span><br><span class="line">    default.target</span><br><span class="line">    ● ├─auditd.service</span><br><span class="line">    ● ├─chronyd.service</span><br><span class="line">    ● ├─crond.service</span><br><span class="line">    ● ├─dbus.service</span><br><span class="line">	...</span><br></pre></td></tr></table></figure></li>
<li><p> 执行sysinit.target，初始化系统，加载基本的核心驱动，文件系统和驱动等。</p>
</li>
<li><p> 执行basic.target加载更多功能，执行完之后，系统就已经启动完毕。</p>
</li>
<li><p> 执行mutli-user.target载入用户服务，如果目标态为图形界面，则继续加载graphical.target。</p>
</li>
</ol>
</div></article></div></main><footer><div class="paginator"><a class="next" href="/2021/03/15/ICMP/">下一篇</a></div><div class="copyright"><p>© 2020 - 2021 <a href="http://yoursite.com">Tian</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/claymcleod/hexo-theme-hermes" target="_blank">hexo-theme-hermes</a>. </p><p>Logo made by <a target="_blank" rel="noopener" href="https://www.flaticon.com/authors/freepik">Freepik</a> from <a target="_blank" rel="noopener" href="https://flaticon.com">www.flaticon.com</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>